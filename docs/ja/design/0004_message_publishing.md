# メッセージの公開

【目次】

## 目的

ワームホールを介してメッセージを公開するためのメカニズムとインターフェースを指定します。

## バックグラウンド

元の汎用メッセージパッシング設計ドキュメントでは、ワームホールメッセージの形式について説明していますが、メッセージの方法については
チェーンエンドポイントを構築するには、公開を明確に定義する必要があります。

## 目標

*メッセージを投稿するためのインターフェースを指定します。
*メッセージ投稿の料金モデルを指定します。

## 非目標

*動的スパム保護。
*料金の分配。

## 概要

すべてのチェーンのコアワームホールコントラクトには、イベントを発行するワームホールにメッセージを投稿するためのメソッドがあります
これは、特定のチェーンで完全なノードを実行している保護者が監視できる必要があります。

料金はそれぞれのチェーンの自国通貨で支払うことになります。料金はすることができます
プロトコルによって要求され、プロトコルルールに従って配布できるSolanaの料金プールに収集されます。

## 詳細設計

ワームホールコアコントラクトには、EOA(外部所有アカウント)またはSC(スマート)で使用できる `postMessage`メソッドがあります
契約)
ワームホールを介してメッセージを公開します。

このメソッドは、** 750バイト**の最大サイズ制限についてペイロードの検証を実行する必要があります。メッセージ
オフラインノードが逃したブロックを再生できるように保護者が拾うことができるように放出する必要があります。

ワームホール契約では、公開されたメッセージの発信者を保護者が利用できるようにする必要もあります。 The
チェーンが呼び出し元が制御していることを証明できる場合、エミッターはpostMessageメソッドのパラメーターです。
上記のアドレス(つまり、Solana PDA)によって承認されているか、トランザクションの送信者です。

さらに、ワームホールコントラクトは、エミッタごとにインクリメントされるシーケンス番号を追跡します。
送信されたメッセージ。

タイムスタンプは、メッセージが公開されたブロックの最終的なタイムスタンプを使用して、保護者のソフトウェアによって取得されます
の。

メッセージが投稿されると、エミッターは保護者が確認するまでに待機する確認の数を指定できます。
アテステーションが作成されます。これにより、遅延の影響を受けやすいアプリケーションは、重要な間、安全性を犠牲にすることができます
アプリケーションは、安全性よりも遅延を犠牲にする可能性があります。インスタントファイナリティを持つチェーンは、引数を省略できます。

**料金:**

保護者にインセンティブを与え、ワームホールネットワークのスパムを防ぐために、メッセージの公開には料金が必要になります
支払い。

この料金は、メッセージを公開するときにチェーンのネイティブ料金通貨のいずれかで支払われることになっています。これは、
トランザクションを送信する人は、トランザクションを公開するために、そのような資産を保持する必要があります。
メッセージ、したがって、料金が橋の使いやすさに悪影響を及ぼさないこと。

料金は、 `SetMessageFee`VAAを使用したガバナンスによって定義されます。設定された料金は、それぞれのチェーンで表示されます
自国通貨。各チェーンのワームホールプログラムは、チェーン上の価格オラクルを使用することになっています(例:ユニスワッププールTWAPまたは
Pyth価格フィード)
プロトコルがチェーンのノードを維持するために必要な労力を考慮に入れることができるように、料金はチェーンごとに設定されます
オンラインでスパム攻撃を説明します。

料金は、ワームホール契約、ガバナンス、またはより自動化されたメカニズムによって制御されるウォレットに収集されます
後の設計ドキュメントで実装される予定のドキュメントは、収集されたものを移動できるようにする「TransferFees」を生成できるようになります
指定されたアドレスへの料金トークン。 広く受け入れられているトークンブリッジがある場合、このメカニズムは次のように拡張される可能性があります。
トークンをチェーンにブリッジして、ガバナンスおよびステーキング契約が配置されているチェーンに戻し、そこで配布します。

### API/データベーススキーマ

提案されたブリッジインターフェイス:

`postMessage(bytespayload、u8confirmations)`-ワームホールによって証明されるメッセージを公開します。

`setFees(VAA fee_payload)` -` SetMessageFee`VAAを使用して料金を更新します

`transferFees(VAA transfer_payload)` -` TransderFees`VAAを使用した送金手数料

---

**ペイロード**:

ペイロードは、ガバナンスメッセージ形式に従います。

SetMessageFee:

```
//Core Wormhole Module
Module [32]byte = "Core"
//Action index (3 for Fee Update)
Action uint16 = 3
Chain uint16
//Message fee in the native token
Fee uint256
```

TransferFees:

```
//Core Wormhole Module
Module [32]byte = "Core"
//Action index (4 for Fee Transfer)
Action uint16 = 4
Chain uint16
//Amount being transferred (big-endian uint256)
Amount uint256
//Address of the recipient. Left-zero-padded if shorter than 32 bytes
To [32]uint8
```

## 警告

料金の徴収にはガバナンスの決定が必要です。 これは、
スタッカーと保護者への料金の分配。 トークンブリッジがないため、これを早期に自動化することは困難です
プロトコルの日数。 また、転送プリミティブがトークンブリッジをサポートする可能性は低いです(スマートコントラクトが必要になる場合があります)
)なので、契約が必要になります。

##セキュリティに関する考慮事項