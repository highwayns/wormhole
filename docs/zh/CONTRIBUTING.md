# 贡献

Wormhole 是一个开源项目，在 Apache 2 许可下获得许可。贡献很大
感谢并会迅速审查。

虫洞是一项关键任务、高风险的项目。我们优化质量而不是数量。设计流程
代码审查是我们实现这一目标的最重要工具。

- 在开始实施之前，所有新功能必须首先在 GitHub 问题中讨论。为了
  复杂的功能，提交一份[正式的设计文件](design/template.md) 会很有用。

- 开发发生在一个长期存在的开发分支上(通常是 `main` 或 `dev.<x>` 进行较大的更改)。
  进入开发分支的每个更改都会单独审查(见下文)。发布分支分支
  from `main` 用于支持 Wormhole 的野外版本。我们的目标是最多支持两个版本
  同时分支。可以从开发分支中挑选更改到发布分支，但是
  永远不要从发布分支到开发分支。
  
- 发布首先在测试网上进行测试。这涉及与运行节点的主网 DAO 的协调。

- 提交应该很小并且有一个有意义的提交信息。粗略地说，一次提交应该是“一个想法”，并且
  尽可能原子化。一个功能可以由许多这样的提交组成。
  
- 功能标志和界面演变比破坏性更改和长期存在的功能分支更好。
  
- 我们优化阅读，而不是写作 - 在其生命周期中，代码的阅读频率远高于编写频率。
  小的提交、有意义的提交消息和有用的注释使审查代码和改进代码变得更容易
  代码审查的质量以及审查周转时间。发现小错误要容易得多，
  定义明确的变化。

野外部署的文档位于
[虫洞网络](https://github.com/certusone/wormhole-networks) 存储库。

## 贡献常见问题解答

### 你能添加\<随机区块链\>吗？

答案是……也许吧？为了在虫洞中完全支持链，需要以下东西:

- 虫洞主网由 DAO 管理。虫洞的设计是对称的——每个守护节点都需要运行
  Wormhole 支持的每个链的节点或轻客户端。这加起来，并且支持新的障碍
  链是相当高的。您的提案应清楚地概述支持新链的价值主张。
  **说服 DAO 为您的链运行节点是支持新链的第一步。**
  
- 链需要支持能够验证 19 个单独的 secp256k1 签名的智能合约。

- 需要构建和审计智能合约。在某些情况下，可以使用现有合同，例如
  EVM 兼容链。
  
- 需要在guardiand中加入对观察链的支持。

- 需要构建网络钱包集成才能与虫洞进行实际交互。

困难的部分是 (1) 说服 DAO 运行节点，以及 (2) 说服核心开发团队
要么构建集成，要么与外部团队合作构建它。

您应该首先打开一个包含更多详细信息的 GitHub 问题。

<!--
TODO:如何联系 DAO？今天的大部分交流发生在一个 Telegram 群组中，我们应该移动这个
更适合公众查询的地方(话语论坛？)
-->

###你支持\<随机区块链创新\>吗？

大概 :-)。就其核心而言，Wormhole 是一种通用的证明机制，与任何特定类型无关
通信(如传输)。您很可能可以使用现有的虫洞合约来构建您的
自己的功能之上，无需对虫洞本身进行任何更改。

请打开一个 GitHub 问题，概述您的用例，我们可以帮助您构建它！

## 提交更改以供审核

Certus One 使用 **Gerrit** 对 [**forge.certus.one**](https://forge.certus.one) 进行代码审查。格里特有
处理一堆单独的提交，而不是审查整个分支的优势。这使它
通过将大特征分解成更小的部分，更容易审查大特征，并且非常重视
使用有意义的提交消息清理提交。这个工作流程帮助我们编写更好的软件。

我们也接受通过 **GitHub PRs** 的贡献，但我们强烈建议尝试 Gerrit。格里特有
有点学习曲线，但提供了更好的体验(将其视为 Vim 与记事本)。

GitHub 存储库是 Gerrit 存储库的镜像。 GitHub 有一个用于 Git 的全球 CDN，所以如果你计划
要以自动化方式大量克隆 Wormhole 存储库，请从 GitHub 克隆它。

### 为什么是 Gerrit？

使用 GitHub，如果您想提交三个更改 A、B 和 C 以供审核(按此顺序)，您有两个
选择:

- 提交一个带有仔细重新提交的 PR，并要求审阅者实际查看您的
  仔细编写提交消息并单独审查每个提交。但是，这没有得到很好的支持
  通过 UI，只能为整个堆栈提供批准，而重新设置/添加提交则完全破坏了它。
  它也不适用于许多项目使用的壁球合并策略。
  
- 提交三个不同基础的个人 PR。这允许您批准和合并每个更改
  单独，但需要您手动重新设置多个分支的基础，这很烦人。

通过将更改分解成更小的部分变得困难，GitHub 鼓励进行大的、难以审查的更改。
对于 Gerrit，情况正好相反 - **提交一堆更改非常简单**。你可以把你的
在单个分支上更改 A、B 和 C:

    C  <-- HEAD
    ↑
    B
    ↑
    A
    ↑
    O <-- origin/main, main
    ↑
    …

...并使用单个`git push origin HEAD:refs/for/main`提交所有三个。 Gerrit 将创建评论
请求 A、B 和 C，它了解它们之间的关系链。 C只能在B和之后合并
C，合并 C 也会自动合并 B 和 C。

这意味着可以在 B 和 C 完成之前对 A 进行审查、批准和合并。然后其他团队成员可以
开始在 A 上构建并避免“可怕的大合并”。此工作流程通常称为**基于中继的开发**。

Gerrit 的其他优点包括:

- 能够**比较不同版本的更改**，并在其原始位置显示内联注释。
  这在重新审查更改时非常有用。
- 保持跨变基的内联注释(！)。
- 非常灵敏的用户界面，可以使用键盘快捷键完全驱动。
  GitHub 可能很慢 - 打开 PR 并显示差异通常需要几秒钟。
- 一个视图，显示打开评论的概述、它们的状态和一个小代码片段。
- 评论可以附加到选择，而不仅仅是整行。
  多条线可以连接到同一条线上。
- 带有细粒度状态机的“**注意力集**”机制，谁需要采取行动，
  这避免了发送不可操作的电子邮件通知！
- 我们运行自己的基础设施。是的去中心化！

### 快速开始

您可以使用 Google 帐户登录 Gerrit。 **如果您代表公司做出贡献，请
确保您的 Git 电子邮件地址反映了您的隶属关系！**

首先，在您的 [配置文件设置](https://forge.certus.one/settings/#SSHKeys) 中将您的 SSH 密钥添加到 Gerrit。
或者，您可以生成一个 HTTP 密码并将其存储在您的 [Git 凭据存储
选择](https://git-scm.com/book/en/v2/Git-Tools-Credential-Storage) - 这对以下情况特别有用
无法使用 SSH 或访问您的密钥的开发主机或企业环境。

**从 Gerrit 克隆 repo** 如果您还没有这样做，请转到 [repository
page](https://forge.certus.one/admin/repos/wormhole) 并使用 *"Clone with commit-msg hook"* 命令。如果
您有一个要转换的现有 GitHub 结帐，您只需设置一个新的遥控器即可
第一次推送到 Gerrit 时提示安装钩子:

    git remote set-url origin ssh://<gerrit-username>@[...]

然后，只需提交到本地分支。 每个本地提交都成为一个代码审查请求。 多次提交
同一个分支将作为堆栈提交(见上文)。 完成后，推到特别参考
创建您的代码审查:

    git push origin HEAD:refs/for/main

(在适用的情况下，用不同的开发分支替换 `main`)

而已！ 无需特殊工具。 您现在可以在 Web UI 中查看您的提交并添加审阅者。 如果
你想少打字，看看这些:

- 有一个优秀的 [IntelliJ 插件](https://plugins.jetbrains.com/plugin/7272-gerrit) 可以让你克隆，
   从 IDE 内部检查甚至查看 CL。

- Go 项目的 [git-codereview](https://pkg.go.dev/golang.org/x/review/git-codereview) CLI 实用程序。