# 安全假设

本页详细介绍了 Wormhole 依赖于安全性和可用性的各种假设。其中许多是
适用于各种去中心化协议的通用假设。

本文档假设您熟悉虫洞概念，如 VAA。

## Gossip 网络可用性

虫洞的点对点八卦网络依赖于 [go-libp2p](https://github.com/libp2p/go-libp2p) 和
[go-libp2p-pubsub](https://github.com/libp2p/go-libp2p-pubsub) 库。 libp2p 是一个非常流行的库，被许多人使用
主要的去中心化网络，如 IPFS 和以太坊 2.0。然而，像任何分布式协议一样，它可能是
容易受到可能导致消息丢失或淹没单个节点的各种拒绝服务攻击。

我们确实_不_依赖 libp2p 来确保安全性，仅是为了可用性。 libp2p 的通道被加密和认证
默认，但我们不依赖该属性。在最坏的情况下，libp2p 传输安全的妥协可能会导致
对八卦网络或单个节点的拒绝服务攻击。

Gossip 网络不可用可能会导致事件丢失，但不会永久存在。节点将定期
尝试为未能达成共识的 VAA 重新传输签名，以减轻短期
网络中断。更长的网络中断，导致超时，以及相关的少数
节点可能会导致观察结果被丢弃。

对此的缓解措施是在 Solana 或其他链的链重播情况下的轮询控制循环。在索拉纳，
节点将持续轮询未处理的观察结果，导致节点重新观察和另一轮
共识。在链重放期间，节点将从给定的块高度重新处理来自连接链的事件，检查
是否已经向 Solana 提交了 VAA，并针对遗漏的观察启动一轮共识。
 
这没有风险，可以进行任意次。 VAA 是完全确定的和幂等的 - 任何
给定的观察结果总是会产生相同的 VAA 正文哈希。所有连接的链都保留永久记录
是否已经执行了给定的 VAA 主体(由其哈希标识)，因此，VAA 可以安全地
经历多轮共识，直到它们在所有链上执行。

桥接器尚未实现链重放(参见 https://github.com/certusone/wormhole/issues/123)。网络中断
因此，在长期网络中断的情况下，可能会导致来自 Solana 以外的其他链的观察丢失。它
在实施链重播以赶上错过的事件后，可以追溯重播区块。

## 链一致性和终结性

虫洞网络总是观察_外部事件_，从不自行启动它们。它依赖于连接
链的共识、安全性和终结性属性。在监护人集更新的情况下，它依赖于链下
以同样的方式达成运营商共识。

Wormhole 依赖的外部链属性的非详尽列表:

- 可以假设在某个时刻，事务是最终的并且不能回滚。
- 给定的交易仅在单个块中包含/执行一次，从而产生确定性的 VAA 主体。
- 默认情况下或通过 Solana 的租金豁免等机制，帐户数据和状态是永久性的。
- 没有歧义 - 在给定高度只有一个有效块。

## 链上垃圾邮件预防

我们假设所有连接的链都使用费用或类似的机制来防止攻击者淹没网络，
并且虫洞的处理能力大于所有连接链的能力之和。

Solana 具有荒谬的处理能力，并且可以以比其 websocket 更高的速率处理事务
订阅接口，代理或虫洞本身可以处理。这在一定程度上因费用而减轻
虫洞合约收取的费用超过(非常便宜的)交易费用，但一个足够激励的攻击者可以
仍然通过简单地支付所述费用来执行持续攻击。

未来可能的改进是 Solana 方面的动态费用，但这目前被运行时阻止
限制(参见 https://github.com/certusone/wormhole/issues/125)。即使有动态费用，将费用提高到超出
一个合理的用户愿意支付的金额可能已经构成对协议的成功攻击。

对去中心化协议的 DDoS 攻击通常是一件棘手的事情，主要是博弈论/激励问题。
防御策略是动态的，会随着生态系统的发展而演变。因此，我们将此类攻击排除在当前
虫洞威胁模型。假设是执行此类攻击的动机低于费用成本和
攻击者将招致的法律/责任风险，以及维持攻击的成本将不仅仅是简单的
直接攻击连接的链。

## 监护人激励对齐

Wormhole 是一个去中心化的 PoA 桥。其博弈论安全性依赖于精心挑选的运营商，其激励措施
与 Solana 生态系统保持一致——大型代币持有者、生态系统项目、顶级验证者等，谁
攻击网络或忽视他们的声誉、代币价值和生态系统增长的风险
职责。

我们假设目前，这种激励调整比单独的链更容易引导和正确，
这需要精心设计的代币经济和削减标准。特别是它吸引了关心的运营商
短期验证奖励之外的生态系统，从而产生高质量、有弹性的守护者集。

随着项目的发展，除了抵押代币之外，还有许多潜在的改进需要考虑，包括
[Balsa](https://docs.google.com/document/d/1sCgxHIOrVHAqrt4NWkUJXxQvpSxq6DyZrkf4IR-R-YM/edit) 保险池
提案，以及抵消运营成本和奖励运营商的 DAO。

## 不妥协的主机

这不言而喻 - 在单个节点的上下文中，我们假设对手无法读取或写入主机
内存、执行代码或以其他方式危害正在运行的主机操作系统或平台，同时或之后节点
跑步。如果绝大多数节点受到威胁，攻击者就可以产生任意的 VAA。如果超少数节点
受到损害，网络可能会暂时失去共识(没有办法故意使守护密钥无效或
防止它被绝大多数人取代)。

与流行的看法相反，硬件安全模块_不会_显着改变与主机相关的风险
在处理加密货币密钥时妥协。受感染的主机很容易滥用 HSM 作为签名预言机，
用单一签名造成不可逆转的损坏。它只是使攻击复杂化，但不是主要的。

对于某些用例，例如 PoS 验证，可以通过运行智能 HSM 来完全降低主机受损的风险，例如
[SignOS](https://certus.one/sign-os)。在这些情况下，智能 HSM 可以解析签名负载并应用
像“给定的区块高度只能签名一次”这样的约束，可以在安全的环境中独立验证
飞地。

对于像Wormhole这样的oracle，这个约束是“只有最终确定的事件可以被认证”，这是不可能的
在不验证默克尔证明的情况下进行验证并至少同步一个稀疏的头链。因此，在
Wormhole，整个 Wormhole 实例必须在智能 HSM/SignOS 中运行，包括用于
它支持的链。

## 第三方库

像任何现代软件项目一样，我们依赖于许多外部库。我们应用了最佳实践来处理
此类第三方依赖，包括最小化它们的数量，避免二进制依赖，以及使用锁文件来
将依赖项固定到确切的版本和哈希值，以避免分发级别的妥协。我们假设第三方
我们使用的库是安全的，不包含后门。

由于 [public go.sum
数据库](https://go.googlesource.com/proposal/+/master/design/25530-sumdb.md)。

对于节点软件中的密码学，我们完全依赖 Go 标准库中的高级接口 - 这是
以其稳健性和 go-ethereum 而闻名，两者都经过了详尽的审计。

## 安全处理 Solana eBPF VM 中的崩溃

由于 Solana 运行时的指令数限制，Solana 合约自由地使用了不安全的块
序列化和反序列化数据，而不会产生内存安全方法的开销。

这遵循 Solana 合同开发的当前最佳实践。它假定无效操作或越界
访问总是会导致崩溃并被字节码解释器捕获，并安全地停止合约执行，例如
合同执行期间的任何其他错误都会。 